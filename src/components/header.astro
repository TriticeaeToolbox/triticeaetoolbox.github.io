---
import { Icon } from 'astro-icon/components'
---

<section id="header" class="relative h-full overflow-hidden">
  
  <!-- header background image -->
  <div class="absolute top-0 left-0 w-full h-full" data-parallax data-speed="0.5">
    <img src="/wheat-1.jpg" class="w-full h-full object-cover" />
  </div>

  <!-- header text -->
  <div class="relative z-10 flex flex-col items-center justify-start h-screen text-center transition duration-750 opacity-0 -translate-y-12" data-replace='{"opacity-0": "opacity-100", "-translate-y-12": "translate-y-0"}' >
    <h1 class="title" data-parallax data-speed="0.85">The Triticeae Toolbox</h1>
    <div id="subtitle" class="subtitle opacity-50 hover:opacity-80" data-parallax data-fade data-speed="0.55">
      <Icon name="line-md:arrow-down" />
      <p>View Databases</p>
      <Icon name="line-md:arrow-down" />
    </div>
  </div>

</section>
<div id="header-bottom"></div>

<script>
  // Get max scroll of header
  const maxScrollTop = document.getElementById('header')?.offsetWidth || 0;

  // Add parallax scrolling to header
  const parallaxEls = document.querySelectorAll('[data-parallax]') as NodeListOf<HTMLElement>;
  window.addEventListener('scroll', (event) => {
    const scrollTop = window.pageYOffset;
    parallaxEls.forEach(el => {
      const speed = parseFloat(el.getAttribute('data-speed') || '1');
      el.style.transform = `translateY(${scrollTop * speed}px)`;

      // Add optional fading
      const fade = el.hasAttribute('data-fade');
      if ( fade ) {
        let starting = 1;
        el.classList.forEach((e) => {
          if ( e.startsWith("opacity-") ) {
            starting = parseFloat(e.split("-")[1])/100;
          }
        })
        const opacity = starting-(scrollTop/maxScrollTop);
        el.style.opacity = fade ? `${opacity}` : `1`;
      }

    });
  });

  // Add scroll link to subtitle
  document.getElementById("subtitle")?.addEventListener('click', () => {
    const header = document.getElementById("header-bottom");
    header?.scrollIntoView({ behavior: "smooth", block: "start" });
  });

</script>